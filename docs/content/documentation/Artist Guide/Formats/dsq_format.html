<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<HEAD><SCRIPT SRC="../../../include/tutorial.js" LANGUAGE="JavaScript"></SCRIPT>
<SCRIPT SRC="../../../include/prototype.js" LANGUAGE="JavaScript"></SCRIPT>
<SCRIPT SRC="../../../include/scriptaculous.js" LANGUAGE="JavaScript"></SCRIPT>
<SCRIPT SRC="../../../include/glossaryLookUp.js" LANGUAGE="JavaScript"></SCRIPT>
<SCRIPT SRC="../../../include/referenceLookUp.js" LANGUAGE="JavaScript"></SCRIPT>
<SCRIPT SRC="../../../include/component.js" LANGUAGE="JavaScript"></SCRIPT>
<SCRIPT SRC="../../../include/componentContainer.js" LANGUAGE="JavaScript"></SCRIPT>
<SCRIPT>DocImagePath = "../../../";</SCRIPT><link href="../../../include/tutorialStyles.css" rel="stylesheet" type="text/css" />
<link href="../../../include/tutorial.css" rel="stylesheet" type="text/css" />
<link href="../../../include/globalMainPageStyles.css" rel="stylesheet" type="text/css" />
<link href="../../../include/referenceThemeStyle.css" rel="stylesheet" type="text/css" />
<link href="../../../include/docTheme/theme.css" rel="stylesheet" type="text/css" />
<script>
   // this script chunk is to update the ToC to the current doc and expand it
   pageID = 3;
   parent.leftFrame.expandToItem('tree2', 'doc3');
   var element = parent.leftFrame.document.getElementById('doc3');
   if((element) && (element.className==parent.leftFrame.nodeClosedClass))
{
   element.className = parent.leftFrame.nodeOpenClass
}
;
</script>
<link rel="stylesheet" type="text/css" href="../../../include/container.css" />
<link rel="stylesheet" type="text/css" href="../../../include/content.css" />
<title>DSQ Format Specification</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>

<BODY id = "BODYID" onLoad = "initComponent()" >
<table width="700" cellspacing="0" cellpadding="15" border="0" style="text-align: justify;" xmlns="">
<tr>
<td width="700">
        <table border="0" cellpadding="0" cellspacing="0" width="700">
          <tbody>
            <tr>
              <td width="700"><table id="toc" summary="Contents">
                  <tbody>
                    <tr>
                      <td><div id="toctitle">
                          <h2>Contents</h2>
                          </div>
                        <ul>
                          <li class="toclevel-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
                          <li class="toclevel-1"><a href="#DSQ_Format"><span class="tocnumber">2</span> <span class="toctext">DSQ Format</span></a></li>
                          <li class="toclevel-1"><a href="#SEQUENCES"><span class="tocnumber">3</span> <span class="toctext">Sequences</span></a></li>
                          <li class="toclevel-1"><a href="#BITSETS"><span class="tocnumber">4</span> <span class="toctext">Bitsets</span></a></li>
                          
                        </ul></td>
                    </tr>
                  </tbody>
                </table>
                <a name="Introduction"></a>
<h1>Introduction</h1>
<p><br /></p>
<p>DSQ is the native, binary format used by the Torque engine to store animation data. This document serves as a basic specification for the DSQ file format. Very little context is given to the sequence data fields read from the DSQ file so it is recommended that this resource be read along with the Torque source code. The DSQ file format is shown below. Note that all values are stored as little-endian, so on non-Intel platforms you will have to handle perform endian conversion for 16 and 32-bit values.</p><br>
<p><strong><em>Note: </em></strong><em>All values are stored as little-endian, so on non-Intel platforms you will have to perform endian conversion for 16 and 32-bit values.</em></p>
<a name="DSQ_Format"></a>
<h1>DSQ Format</h1>
<table border=1>
 <tr><th>Name</th><th># bytes</th><th>Data Type</th><th>Description</th></tr>
 <tr><td>DSQ version number</td><td>2</td><td>S16</td><td>DSQ version of this file. Note that the current DSQ version (for files saved by T3D) is 26. Most DTS exporters and the ShowToolPro tool only read/write version 24. There is actually no difference between v26 and v24, but files generated by T3D will always use the latest DTS version number.</td></tr>
 <tr><td>Exporter version number</td><td>2</td><td>S16</td><td>For tracking version of the exporter that generated this file. Can usually be ignored.</td></tr>
 <tr><td>numNodes</td><td>4</td><td>S32</td><td>Number of nodes in the shape</td></tr>
 <tr><td>nodeNames</td><td>numNodes * ?</td><td>S32 and char[]</td><td>Node names stored as a 4-byte length followed by N characters (terminating NULL not included in length or DSQ file)</td></tr>
 <tr><td>dummy</td><td>4</td><td>S32</td><td>Dummy value</td></tr>
 <tr><td>numObjects</td><td>4</td><td>S32</td><td>Number of objects in the shape</td></tr>
 <tr><td>numNodeRotations</td><td>4</td><td>S32</td><td>Number of node rotation keyframes</td></tr>
 <tr><td>nodeRotations</td><td>numNodeRotations * 8</td><td>Quat16 { S16 x, S16 y, S16 z, S16 w }</td><td>Array of quaternions for node rotation keyframes (all sequences)</td></tr>
 <tr><td>numNodeTranslations</td><td>4</td><td>S32</td><td>Number of node translation keyframes</td></tr>
 <tr><td>nodeTranslations</td><td>numNodeTranslations * 12</td><td>Point3F { F32 x, F32 y, F32 z }</td><td>Array of points for node translation keyframes (all sequences)</td></tr>
 <tr><td>numNodeUniformScales</td><td>4</td><td>S32</td><td>Number of node uniform scale keyframes</td></tr>
 <tr><td>nodeUniformScales</td><td>numNodeUniformScales * 4</td><td>F32</td><td>Array of floats for node uniform scale keyframes (all sequences)</td></tr>
 <tr><td>numNodeAlignedScales</td><td>4</td><td>S32</td><td>Number of node aligned scale keyframes</td></tr>
 <tr><td>nodeAlignedScales</td><td>numNodeAlignedScales * 12</td><td>Point3F { F32 x, F32 y, F32 z }<td>Array of points for node aligned scale keyframes (all sequences)</td></tr>
 <tr><td>numNodeArbScales</td><td>4</td><td>S32</td><td>Number of node arbitrary scale keyframes</td></tr>
 <tr><td>nodeArbScaleRots</td><td>numNodeArbScales * 8</td><td>Quat16 { S16 x, S16 y, S16 z, S16 w }</td><td>Array of quaternions for node arbitrary scale rotation keyframes (all sequences)</td></tr>
 <tr><td>nodeArbScaleFactors</td><td>numNodeArbScales * 12<td>Point3F { F32 x, F32 y, F32 z }</td><td>Array of points for node arbitrary scale factor keyframes (all sequences)</td></tr>
 <tr><td>numGroundFrames</td><td>4</td><td>S32</td><td>Number of ground transform keyframes</td></tr>
 <tr><td>groundTranslations</td><td>4</td><td>Point3F { F32 x, F32 y, F32 z }<td>Array of points for ground transform keyframes (all sequences)</td></tr>
 <tr><td>groundRotations</td><td>2</td><td>Quat16 { S16 x, S16 y, S16 z, S16 w }<td>Array of quaternions for ground transform keyframes (all sequences)</td></tr>
 <tr><td>dummy</td><td>4</td><td>S32</td><td>Dummy value</td></tr>
 <tr><td>numSequences</td><td>4</td><td>S32</td><td>Number of sequences in the shape</td></tr>
 <tr><td>sequences</td><td>numSequences * ?</td><td>Sequence</td><td>Array of <a href="#SEQUENCES">Sequences</a> - size of each sequence depends on which nodes are affected etc.</td></tr>
 <tr><td>numTriggers</td><td>4</td><td>S32</td><td>Number of triggers (all sequences)</td></tr>
 <tr><td>triggers</td><td>4</td><td>Trigger { U32 state, F32 pos }<td>Array of sequence triggers (all sequences)</td></tr>
</table>
<br><br>
<h2><a name="SEQUENCES">Sequences</a></h2>

<p>Sequences are stored in the DSQ file as shown below. Note that this is almost identical to how sequences are stored in <a href="dts_format.html#SEQUENCES">DTS files</a> except for the name:</p>

<table border=1>
 <tr><th>Name</th><th># bytes</th><th>Data Type</th><th>Description</th></tr>
 <tr><td>name</td><td>?</td><td>S32 and char[]</td><td>The name of this sequence stored as a 4-byte length followed by N characters (terminating NULL not included in length or DSQ file)</td></tr>
 <tr><td>flags</td><td>4</td><td>U32</td><td>Sequence flags</td></tr>
 <tr><td>numKeyframes</td><td>4</td><td>S32</td><td>Number of keyframes in this sequence</td></tr>
 <tr><td>duration</td><td>4</td><td>F32</td><td>Duration of the sequence (in seconds)</td></tr>
 <tr><td>priority</td><td>4</td><td>S32</td><td>Sequence priority</td></tr>
 <tr><td>firstGroundFrame</td><td>4</td><td>S32</td><td>First ground transform keyframe in this sequence (index into the groundTranslations and groundRotation arrays)</td></tr>
 <tr><td>numGroundFrames</td><td>4</td><td>S32</td><td>Number of ground transform keyframes in this sequence</td></tr>
 <tr><td>baseRotation</td><td>4</td><td>S32</td><td>First node rotation keyframe in this sequence (index into the nodeRotations array)</td></tr>
 <tr><td>baseTranslation</td><td>4</td><td>S32</td><td>First node translation keyframe in this sequence (index into the nodeTranslations array)</td></tr>
 <tr><td>baseScale</td><td>4</td><td>S32</td><td>First node scale keyframe in this sequence (index into the nodeXXXScales arrays)</td></tr>
 <tr><td>baseObjectState</td><td>4</td><td>S32</td><td>First object state keyframe in this sequence (index into the objectStates array)</td></tr>
 <tr><td>baseDecalState</td><td>4</td><td>S32</td><td>First decal state keyframe in this sequence (index into the decalStates array). Note that DTS decals are deprecated, and this value should be 0.</td></tr>
 <tr><td>firstTrigger</td><td>4</td><td>S32</td><td>First trigger in this sequence (index into the triggers array)</td></tr>
 <tr><td>numTriggers</td><td>4</td><td>S32</td><td>Number of triggers in this sequence</td></tr>
 <tr><td>toolBegin</td><td>4</td><td>F32</td><td>Value representing the start of this sequence in the exporting tool's timeline (can usually by ignored)</td></tr>
 <tr><td>rotationMatters</td><td>?</td><td>BitSet</td><td><a href="#BITSETS">BitSet</a> indicating which node rotations are animated by this sequence.</td></tr>
 <tr><td>translationMatters</td><td>?</td><td>BitSet</td><td><a href="#BITSETS">BitSet</a> indicating which node translations are animated by this sequence.</td></tr>
 <tr><td>scaleMatters</td><td>?</td><td>BitSet</td><td><a href="#BITSETS">BitSet</a> indicating which node scales are animated by this sequence.</td></tr>
 <tr><td>decalMatters</td><td>?</td><td>BitSet</td><td><a href="#BITSETS">BitSet</a> indicating which decal states are animated by this sequence. Note that DTS decals are deprecated.</td></tr>
 <tr><td>iflMatters</td><td>?</td><td>BitSet</td><td><a href="#BITSETS">BitSet</a> indicating which IFL materials are animated by this sequence.</td></tr>
 <tr><td>visMatters</td><td>?</td><td>BitSet</td><td><a href="#BITSETS">BitSet</a> indicating which object's visibility is animated by this sequence.</td></tr>
 <tr><td>frameMatters</td><td>?</td><td>BitSet</td><td><a href="#BITSETS">BitSet</a> indicating which mesh's verts are animated by this sequence.</td></tr>
 <tr><td>matFrameMatters</td><td>?</td><td>BitSet</td><td><a href="#BITSETS">BitSet</a> indicating which mesh's UV coords are animated by this sequence.</td></tr>
</table>
<br><br>
<h2><a name="BITSETS">BitSets</a></h2>

<p>BitSets are stored in the DSQ file as:</p>

<table border=1>
 <tr><th>Name</th><th># bytes</th><th>Data Type</th><th>Description</th></tr>
 <tr><td>dummy</td><td>4</td><td>S32</td><td>Dummy value</td></tr>
 <tr><td>numWords</td><td>4</td><td>S32</td><td>Number of 32-bit values in the BitSet</td></tr>
 <tr><td>bits</td><td>4 * numWords</td><td>U32</td><td>Array of 32-bit values representing the bits in the BitSet</td></tr>
</table>

</td></tr></table><div class="footer">   <a href="../../../content_welcome.html" target="">Home</a>   <a href="#">Back to Top</a></div></body>
</html>
